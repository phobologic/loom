---
id: loo-6300
status: closed
deps: [loo-ofqu]
links: []
created: 2026-02-27T00:04:40Z
type: task
priority: 2
assignee: Michael Barrett
parent: loo-82fd
---
# Migrate simple test files to shared fixtures

Remove the per-test create_all/drop_all client fixtures from the simple test files — those with no direct DB assertions in test bodies. Once the shared fixtures exist in conftest.py (loo-ofqu), these files just need their local client fixture deleted.

## Files in scope (no _test_session_factory global)
- tests/test_safety_tools.py
- tests/test_oracles.py
- tests/test_notifications.py
- tests/test_characters.py
- tests/test_session0.py
- tests/test_world_document.py

## Work per file
1. Delete the local @pytest.fixture async def client() block (the old create_all/drop_all version)
2. Remove now-unused imports: create_async_engine, async_sessionmaker, Base (if not used elsewhere in the file)
3. Run the file's tests to confirm they still pass using the conftest.py client fixture

## Verification — measure the speedup
For each file, record time BEFORE (while the old fixture is still in place):
  time uv run pytest -v tests/test_<name>.py

Then make the change and record time AFTER:
  time uv run pytest -v tests/test_<name>.py

Include both timings in a comment or note on this ticket. Expected: roughly 6x fewer create_all/drop_all cycles per file.

After all files are done, run the full suite:
  uv run pytest -q --tb=short
All tests should still pass.


## Notes

**2026-02-27T02:10:05Z**

Before: 86.99s for 122 tests across 6 files. After: 38.95s for same 122 tests. 2.2x speedup.
