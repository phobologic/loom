{% extends "base.html" %}

{% block title %}{{ game.name }} â€” Loom{% endblock %}

{% block content %}
<h1>{{ game.name }}</h1>
<p><strong>Status:</strong> {{ game.status.value | capitalize }}</p>

<nav>
    <strong>Nav:</strong>
    <a href="#" aria-disabled="true">Acts</a> |
    <a href="/games/{{ game.id }}/settings">Settings</a> |
    {% if game.status.value == "setup" %}<a href="/games/{{ game.id }}/session0">Session 0</a> | {% endif %}
    <a href="/games/{{ game.id }}/safety-tools">Safety Tools</a> |
    <a href="/games/{{ game.id }}/world-document">World Doc</a>
</nav>

{% if game.status.value == "setup" %}
<section style="margin-top:1rem; padding:0.75rem; border:1px solid #ccc;">
  <h2>Session 0</h2>
  <p>Establish the world collaboratively before play begins.</p>
  <a href="/games/{{ game.id }}/session0">
    {% if current_member.role.value == "organizer" %}Run Session 0 Wizard{% else %}Contribute to Session 0{% endif %}
  </a>
</section>
{% endif %}

<h2>Members ({{ members | length }}/{{ max_players }})</h2>
<ul>
    {% for m in members %}
    <li>
        {{ m.user.display_name }}
        {% if m.role.value == "organizer" %}<em>(organizer)</em>{% endif %}
    </li>
    {% endfor %}
</ul>

{% if current_member.role.value == "organizer" %}
<h2>Invite Link</h2>
{% if invite_url %}
<p>Share this link with players:</p>
<code>{{ invite_url }}</code>
<div style="margin-top:0.5rem;">
    <form method="post" action="/games/{{ game.id }}/invite/regenerate" style="display:inline;">
        <button type="submit">Regenerate</button>
    </form>
    <form method="post" action="/games/{{ game.id }}/invite/revoke" style="display:inline; margin-left:0.5rem;">
        <button type="submit">Revoke</button>
    </form>
</div>
{% else %}
<p>Invite link has been revoked.</p>
<form method="post" action="/games/{{ game.id }}/invite/regenerate">
    <button type="submit">Generate new invite link</button>
</form>
{% endif %}
{% endif %}

{% if current_member.role.value == "organizer" %}
<section style="margin-top:1.5rem; border-top:1px solid #ddd; padding-top:1rem;">
  <h2>Game Management</h2>
  {% if game.status.value == "active" %}
  <form method="post" action="/games/{{ game.id }}/pause" style="display:inline;">
    <button type="submit">Pause Game</button>
  </form>
  {% endif %}
  {% if game.status.value == "paused" %}
  <form method="post" action="/games/{{ game.id }}/resume" style="display:inline;">
    <button type="submit">Resume Game</button>
  </form>
  {% endif %}
  {% if game.status.value != "archived" %}
  <form method="post" action="/games/{{ game.id }}/archive" style="display:inline; margin-left:0.5rem;">
    <button type="submit" onclick="return confirm('Archive this game? It will become read-only.')">Archive Game</button>
  </form>
  {% endif %}
</section>
{% endif %}

<p style="margin-top:1rem;"><a href="/games">&larr; My Games</a></p>
{% endblock %}
